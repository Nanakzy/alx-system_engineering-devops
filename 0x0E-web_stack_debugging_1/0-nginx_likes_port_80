#!/usr/bin/env bash                                                      

# Fix Nginx configuration to listen on port 80
sed -i '/listen\s*80;/!{s/listen[^;]*;/$&\n\tlisten 80;/}' /etc/nginx/sites-available/default

# Restart Nginx service
service nginx restart

# Wait for Nginx to restart
sleep 1

# Check if Nginx is listening on port 80
if ! curl -sSf 0:80 > /dev/null; then
    echo "Error: Nginx is not listening on port 80."
    exit 1
fi

echo "Nginx configuration fixed. Now listening on port 80."
